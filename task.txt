Store code is: 
import testService from "../../../services/testService";
import schemaServive from "../../../services/schemaService";
const testSlice = (set, get) => ({
  // State
  testList: [],
  testAssociatedSchemaList: [],
  testListByCategory: [],
  loadTestList: async () => {
    try {
      get().startLoading();
      const response = await testService.geTestList();
      set({ testList: response.data });
    } catch (e) {
      set({ popup: { type: "error", message: "Failed to load test list", action: null, data: null } });
    } finally {
      get().stopLoading();
    }
  },
  loadTestListByCategory: async (categoryId) => {
    try {
      get().startLoading();
      const response = await testService.getTestsByCategory(categoryId);
      set({
        testList: response.data,
        popup: {
          type: "success",
          message: `Loaded ${response.data.length} test(s) for this category`,
        },
      });
    } catch (e) {
      const msg = e.response?.data?.message || "Invalid Category ID or no tests found";
      set({ popup: { type: "error", message: msg } });
    } finally {
      get().stopLoading();
    }
  },
  addTest: async (categoryId, name) => {
    try {
      get().startLoading();
      console.log(categoryId, name);
      const response = await testService.addTest({ categoryId: categoryId, name: name });
      console.log(response.data.test);
      const newTest = response.data.test; // Assuming .test based on console.log; change to response.data if needed
      set((state) => ({
        testList: [...state.testList, newTest],
        popup: { type: "success", message: "New Test added successfully" },
      }));
      get().closeModal();
    } catch (e) {
      let message = "Failed to add test";
      if (e.response?.data?.duplicate) {
        message = e.response.data.message;
      }
      set({ popup: { type: "error", message: message, action: null, data: null } });
    } finally {
      get().stopLoading();
    }
  },
  editTest: async (testId, categoryId, name) => {
    try {
      get().startLoading();
      const updated = { testId, categoryId, name };
      const response = await testService.editTest(updated);
      get().closeModal();
      set((state) => ({
        testList: state.testList.map((test) => (test._id === testId ? { _id: testId, categoryId, name } : test)),
        popup: { type: "success", message: "Test updated successfully", data: null, action: null },
      }));
    } catch (e) {
      let message = "Failed to update Test";
      if (e.response?.data?.duplicate) {
        message = e.response.data.message;
      }
      set({ popup: { type: "error", message, data: null, action: null } });
    } finally {
      get().stopLoading();
    }
  },

  deleteTest: async () => {
    try {
      get().startLoading();
      const { testId } = get().popup.data;
      await testService.deleteTest(testId);
      set((state) => ({
        popup: { type: "success", message: "Test deleted successfully", data: null, action: null },
        testList: state.testList.filter((test) => test._id !== testId),
      }));
      get().closeModal();
    } catch (e) {
      console.log(e);
      set({
        popup: { type: "error", message: "Failed to delete test", action: null, data: null },
      });
    } finally {
      get().stopLoading();
    }
  },
  loadTestSchema: async (testId) => {
    try {
      get().startLoading();
      const response = await schemaServive.getByTestId(testId);
      set((state) => ({
        testAssociatedSchemaList: response.data,
      }));
      console.log(response.data);
      if (response.data.length === 0) {
        set({ popup: { type: "error", message: "No Schema has been added for this test", data: null, action: null } });
        get().closeModal();
      }
    } catch (e) {
      set({ popup: { type: "error", message: "Failed to load test associated schemas", data: null, action: null } });
      get().closeModal();
    } finally {
      get().stopLoading();
    }
  },
  setSchema: async (testId, schemaId) => {
    try {
      get().startLoading();
      await testService.setSchema(testId, schemaId);
      get().closeModal();
      set((state) => ({
        testList: state.testList.map((test) => (test._id === testId ? { ...test, schemaId: schemaId } : test)),
        populatedList: state.populatedList.map((cat) => ({
          ...cat,
          testList: cat.testList.map((test) => (test._id === testId ? { ...test, schemaId: schemaId } : test)),
        })),
        popup: {
          type: "success",
          message: "Schema set successfully",
          data: null,
          action: null,
        },
      }));
    } catch (e) {
      set({ popup: { type: "error", message: "Failed to set schema", data: null, action: null } });
    } finally {
      get().stopLoading();
    }
  },
  unsetSchema: async () => {
    try {
      get().startLoading();
      const { testId } = get().popup.data;
      await testService.unsetSchema(testId);
      get().closeModal();
      set((state) => ({
        testList: state.testList.map((test) => (test._id === testId ? { ...test, schemaId: null } : test)),
        populatedList: state.populatedList.map((cat) => ({
          ...cat,
          testList: cat.testList.map((test) => (test._id === testId ? { ...test, schemaId: null } : test)),
        })),
        popup: {
          type: "success",
          message: "Removed schema successfully",
          data: null,
          action: null,
        },
      }));
    } catch (e) {
      set({
        popup: {
          type: "error",
          message: "Failed to remove schema",
          data: null,
          action: null,
        },
      });
    } finally {
      get().stopLoading();
    }
  },
  clearTestList: () => set({ testList: [] }),
});
export default testSlice;

import testCategoryService from "../../../services/testCategoryService";

const categorySlice = (set, get) => ({
  categoryList: [],

  populatedList: [],

  loadCategoryList: async () => {
    try {
      get().startLoading();
      const response = await testCategoryService.getCategoryList();
      console.log(response.data);
      set({ categoryList: response.data });
    } catch (e) {
    } finally {
      get().stopLoading();
    }
  },

  populateCategory: async () => {
    try {
      get().startLoading();
      const response = await testCategoryService.getPopulatedList();
      console.log(response.data);
      set((state) => ({ populatedList: [...response.data] }));
    } catch (e) {
      set({ popup: { type: "error", message: "Failed to load populated test list" } });
    } finally {
      get().stopLoading();
    }
  },

  addCategory: async (name) => {
    try {
      get().startLoading();
      const response = await testCategoryService.addCategory({ name });
      console.log(response.data);

      set((state) => ({
        categoryList: [...state.categoryList, response.data],
        popup: { type: "success", message: "Category added successfully" },
      }));
      get().closeModal();
    } catch (e) {
      let message = "Failed to add test";
      if (e.response?.data?.duplicate) {
        message = e.response.data.message;
      }
      set({ popup: { type: "error", message: message, action: null, data: null } });
    } finally {
      get().stopLoading();
    }
  },
  editCategory: async (categoryId, name) => {
    try {
      get().startLoading();
      const response = await testCategoryService.editCategory({ categoryId, name });
      console.log(response.data);
      get().closeModal();
      set((state) => ({
        categoryList: state.categoryList.map((item) => (item._id === categoryId ? { _id: categoryId, name } : item)),
        popup: { type: "success", message: "Category updated successfully", data: null, action: null },
      }));
    } catch (e) {
      let message = "Failed to update category";
      if (e.response?.data?.duplicate) {
        message = e.response.data.message;
      }
      set({ popup: { type: "error", message, data: null, action: null } });
    } finally {
      get().stopLoading();
    }
  },

  deleteCategory: async () => {
    try {
      get().startLoading();
      const { categoryId } = get().popup.data;
      await testCategoryService.deleteCategory(categoryId);
      set((state) => ({
        popup: { type: "success", message: "Category deleted successfully", data: null, action: null },
        categoryList: state.categoryList.filter((item) => item._id !== categoryId),
      }));
      get().closeModal();
    } catch (e) {
      console.log(e);
      set({
        popup: { type: "error", message: "Failed to delete category", action: null, data: null },
      });
    } finally {
      get().stopLoading();
    }
  },
});

export default categorySlice;




import { create } from "zustand";

import loadingSlice from "../../../store/common/loadingSlice";
import modalSlice from "../../../store/common/modalSlice";
import popupSlice from "../../../store/common/popupSlice";

import testSlice from "./testSlice";
import categorySlice from "./categorySlice";

const useStore = create((set, get) => ({
  ...loadingSlice(set, get),
  ...modalSlice(set, get),
  ...popupSlice(set, get),

  ...testSlice(set, get),
  ...categorySlice(set, get),

  clearState: () =>
    set({
      loading: false,
      popup: { type: null, action: null, message: null, data: null },
      modal: { view: null, data: null },
    }),
}));

export default useStore;



From the above store code and api call I will modify like- an API call to get all test list and another 
api call to get all test list. then merge them by categorySlice. All tests under category-A will be listed together.

if a test doesnt get its associated category, it will go under a category named "uncategorized".

here is the category and test document structure:
Category document: 
{
  "_id": {
    "$oid": "693483459118d3524b63b43a"
  },
  "name": "BLOOD"
}

Test Document:
{
  "_id": {
    "$oid": "693c7d5c8b74ebf4ae99d390"
  },
  "name": "CBC",
  "categoryId": {
    "$oid": "693483459118d3524b63b43a"
  },
  "schemaId": null
}

Api response will be array for each api call of test and category.

if a test has a schemaId with non-null or undefined value then the test will be countet as LIVE
and if null or undefined then Offline.

later while adding a new test to a category or adding a new category, I want the page to show the change instantly 
without reload or api call or by the refresh button click.

Any change to a test or category must be reflected without reload and efficiently in easier and readable code.

then give me the followin code refactored,,, keep the layout same but you can change any business logic anywhere or refactor (Add/edit/delete any component) it accordingly

here is the jsx code and components:

import { useEffect, useState } from "react";
import LoadingScreen from "../../components/loadingPage";
import Popup from "../../components/popup/Popup";
import Modal from "../../components/modal";
import useStore from "./store";
import Icons from "../../components/icons"; // Import the icons

import TestCard from "./TestCard";
import TestForm from "./FormTest";
import CategoryForm from "./FormCategory";
import CategoryCard from "./CategoryCard";
import Container from "./Container";

const TestList = () => {
  const [activeView, setActiveView] = useState("container"); // container, testList, categoryList
  const [isAddMenuOpen, setIsAddMenuOpen] = useState(false);

  const {
    populatedList,
    populateCategory,
    testList,
    loadTestList,
    deleteTest,
    categoryList,
    loadCategoryList,
    deleteCategory,
    loading,
    modal,
    setModal,
    popup,
    closePopup,
  } = useStore();

  useEffect(() => {
    populateCategory();
  }, []);

  // Handle view changes
  const switchView = (view) => {
    setActiveView(view);
    if (view === "testList") {
      loadTestList();
    } else if (view === "categoryList") {
      loadCategoryList();
    }
    setIsAddMenuOpen(false);
  };

  // Calculate totals from populatedList which is loaded on mount
  const totalCategories = populatedList?.length || 0;
  const totalTests = populatedList?.reduce((sum, category) => sum + (category.testList?.length || 0), 0) || 0;
  const liveTests =
    populatedList?.reduce((sum, category) => {
      const liveInCategory = category.testList?.filter((test) => test.schemaId)?.length || 0;
      return sum + liveInCategory;
    }, 0) || 0;

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 md:p-6">
      {loading && <LoadingScreen />}

      {/* Popups */}
      {popup && popup.type === "confirmation" && popup.action === "deleteTest" && (
        <Popup type="confirmation" message={popup.message} onConfirm={deleteTest} onClose={closePopup} />
      )}
      {popup && popup.type === "confirmation" && popup.action === "deleteCategory" && (
        <Popup type="confirmation" message={popup.message} onConfirm={deleteCategory} onClose={closePopup} />
      )}
      {popup && popup.type === "success" && <Popup type="success" message={popup.message} onClose={closePopup} />}
      {popup && popup.type === "error" && <Popup type="error" message={popup.message} onClose={closePopup} />}

      {/* Header */}
      <div className="max-w-7xl mx-auto">
        <div className="mb-6">
          {/* Title and Add Button - Same line for both mobile and desktop */}
          <div className="flex items-center justify-between gap-4 mb-6">
            <h1 className="text-2xl md:text-3xl font-bold text-gray-900">Test Management</h1>

            {/* Add Menu */}
            <div className="relative">
              <button
                onClick={() => setIsAddMenuOpen(!isAddMenuOpen)}
                className="px-4 py-2.5 md:px-6 md:py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-medium rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex items-center gap-2 text-sm md:text-base"
              >
                <Icons.Add className="w-4 h-4 md:w-5 md:h-5" />
                Add New
              </button>

              {/* Desktop Dropdown */}
              {isAddMenuOpen && (
                <div className="hidden md:block absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-xl border border-gray-200 z-50 overflow-hidden">
                  <div className="p-1">
                    <button
                      onClick={() => {
                        setModal({ view: "addTest" });
                        setIsAddMenuOpen(false);
                      }}
                      className="w-full px-4 py-3 text-left hover:bg-blue-50 text-gray-700 hover:text-blue-700 transition-colors flex items-center gap-3 rounded-lg"
                    >
                      <div className="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center">
                        <Icons.Add className="w-4 h-4 text-blue-600" />
                      </div>
                      <div>
                        <div className="font-medium">Add New Test</div>
                        <div className="text-xs text-gray-500">Create a new diagnostic test</div>
                      </div>
                    </button>

                    <button
                      onClick={() => {
                        setModal({ view: "addCategory" });
                        setIsAddMenuOpen(false);
                      }}
                      className="w-full px-4 py-3 text-left hover:bg-purple-50 text-gray-700 hover:text-purple-700 transition-colors flex items-center gap-3 rounded-lg"
                    >
                      <div className="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center">
                        <Icons.Folder className="w-4 h-4 text-purple-600" />
                      </div>
                      <div>
                        <div className="font-medium">Add New Category</div>
                        <div className="text-xs text-gray-500">Create a test category</div>
                      </div>
                    </button>
                  </div>
                  <div className="px-4 py-2 border-t border-gray-100 bg-gray-50 text-xs text-gray-500">
                    Quick add options
                  </div>
                </div>
              )}

              {/* Mobile Bottom Sheet */}
              {isAddMenuOpen && (
                <div className="md:hidden fixed inset-0 z-50">
                  {/* Backdrop */}
                  <div
                    className="absolute inset-0 bg-black/50 backdrop-blur-sm"
                    onClick={() => setIsAddMenuOpen(false)}
                  />
                  {/* Sheet */}
                  <div className="absolute bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl border border-gray-200 overflow-hidden">
                    <div className="p-4">
                      <div className="flex items-center justify-between mb-4">
                        <h3 className="text-lg font-semibold text-gray-900">Add New</h3>
                        <button onClick={() => setIsAddMenuOpen(false)} className="p-2 hover:bg-gray-100 rounded-full">
                          <Icons.Close className="w-5 h-5 text-gray-500" />
                        </button>
                      </div>
                      <div className="space-y-3">
                        <button
                          onClick={() => {
                            setModal({ view: "addTest" });
                            setIsAddMenuOpen(false);
                          }}
                          className="w-full p-4 text-left bg-blue-50 hover:bg-blue-100 text-gray-700 hover:text-blue-700 transition-colors rounded-xl flex items-center gap-4"
                        >
                          <div className="w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center">
                            <Icons.Add className="w-5 h-5 text-blue-600" />
                          </div>
                          <div className="text-left">
                            <div className="font-medium text-base">Add New Test</div>
                            <div className="text-xs text-gray-600">Create a new diagnostic test</div>
                          </div>
                        </button>

                        <button
                          onClick={() => {
                            setModal({ view: "addCategory" });
                            setIsAddMenuOpen(false);
                          }}
                          className="w-full p-4 text-left bg-purple-50 hover:bg-purple-100 text-gray-700 hover:text-purple-700 transition-colors rounded-xl flex items-center gap-4"
                        >
                          <div className="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center">
                            <Icons.Folder className="w-5 h-5 text-purple-600" />
                          </div>
                          <div className="text-left">
                            <div className="font-medium text-base">Add New Category</div>
                            <div className="text-xs text-gray-600">Create a test category</div>
                          </div>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* Compact Stats Overview - Without icons */}
          <div className="flex flex-wrap items-center justify-between gap-3 mb-4 px-1">
            <div className="flex items-center gap-4 md:gap-6">
              <div className="text-center">
                <div className="text-xs md:text-sm text-gray-500">Categories</div>
                <div className="text-base md:text-lg font-bold text-gray-900">{totalCategories}</div>
              </div>

              <div className="w-px h-5 md:h-6 bg-gray-200"></div>

              <div className="text-center">
                <div className="text-xs md:text-sm text-gray-500">Tests</div>
                <div className="text-base md:text-lg font-bold text-gray-900">{totalTests}</div>
              </div>

              <div className="w-px h-5 md:h-6 bg-gray-200"></div>

              <div className="text-center">
                <div className="text-xs md:text-sm text-gray-500">Live</div>
                <div className="text-base md:text-lg font-bold text-gray-900">{liveTests}</div>
              </div>
            </div>

            <div className="flex items-center gap-2">
              <button
                onClick={() => window.location.reload()}
                className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-colors flex items-center gap-1.5"
              >
                <span className="btn-sm"> Refresh</span>
              </button>
            </div>
          </div>

          {/* Tab Navigation */}
          <div className="bg-white rounded-2xl shadow-sm border border-gray-200 p-2">
            <div className="flex flex-wrap gap-2">
              <button
                onClick={() => switchView("container")}
                className={`px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${
                  activeView === "container" ? "bg-blue-100 text-blue-700 shadow-sm" : "text-gray-600 hover:bg-gray-100"
                }`}
              >
                <div
                  className={`w-2 h-2 rounded-full ${activeView === "container" ? "bg-blue-500" : "bg-gray-300"}`}
                ></div>
                <span className="hidden sm:inline">Category View</span>
                <span className="sm:hidden">Category</span>
                {activeView === "container" && (
                  <span className="px-1.5 py-0.5 bg-blue-200 text-blue-800 text-xs rounded-full">
                    {populatedList?.length || 0}
                  </span>
                )}
              </button>

              <button
                onClick={() => switchView("testList")}
                className={`px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${
                  activeView === "testList"
                    ? "bg-green-100 text-green-700 shadow-sm"
                    : "text-gray-600 hover:bg-gray-100"
                }`}
              >
                <div
                  className={`w-2 h-2 rounded-full ${activeView === "testList" ? "bg-green-500" : "bg-gray-300"}`}
                ></div>
                All Tests
                {activeView === "testList" && (
                  <span className="px-1.5 py-0.5 bg-green-200 text-green-800 text-xs rounded-full">
                    {testList?.length || 0}
                  </span>
                )}
              </button>

              <button
                onClick={() => switchView("categoryList")}
                className={`px-4 py-2.5 rounded-lg text-sm font-medium transition-all duration-200 flex items-center gap-2 ${
                  activeView === "categoryList"
                    ? "bg-purple-100 text-purple-700 shadow-sm"
                    : "text-gray-600 hover:bg-gray-100"
                }`}
              >
                <div
                  className={`w-2 h-2 rounded-full ${activeView === "categoryList" ? "bg-purple-500" : "bg-gray-300"}`}
                ></div>
                <span className="hidden sm:inline">Categories</span>
                <span className="sm:hidden">List</span>
                {activeView === "categoryList" && (
                  <span className="px-1.5 py-0.5 bg-purple-200 text-purple-800 text-xs rounded-full">
                    {categoryList?.length || 0}
                  </span>
                )}
              </button>
            </div>
          </div>
        </div>

        {/* Main Content Area */}
        <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
          {/* Content Header - Only show for testList and categoryList */}
          {activeView !== "container" && (
            <div className="border-b border-gray-200 px-4 md:px-6 py-3 md:py-4">
              <div className="flex items-center justify-between">
                <div>
                  <h2 className="text-lg md:text-xl font-semibold text-gray-900">
                    {activeView === "testList" && "All Tests"}
                    {activeView === "categoryList" && "Categories"}
                  </h2>
                  <p className="text-xs md:text-sm text-gray-500 mt-1">
                    {activeView === "testList" && "Complete list of all diagnostic tests"}
                    {activeView === "categoryList" && "Manage test categories"}
                  </p>
                </div>

                <div className="flex items-center gap-3">
                  <div className="text-xs md:text-sm text-gray-500">
                    {(activeView === "testList" ? testList : categoryList)?.length || 0} items
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Content Body */}
          <div className={`${activeView === "container" ? "p-0" : "p-4 md:p-6"}`}>
            {activeView === "container" && <Container list={populatedList} />}

            {activeView === "testList" && (
              <div>
                {testList.length === 0 ? (
                  <div className="text-center py-8 md:py-12">
                    <div className="w-14 h-14 md:w-16 md:h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                      <Icons.EmptyState className="w-6 h-6 md:w-8 md:h-8 text-gray-400" />
                    </div>
                    <h3 className="text-base md:text-lg font-semibold text-gray-700 mb-2">No tests found</h3>
                    <p className="text-sm text-gray-500 mb-4">Add your first test to get started</p>
                    <button
                      onClick={() => setModal({ view: "addTest" })}
                      className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm md:text-base"
                    >
                      Add New Test
                    </button>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                    {testList.map((test) => (
                      <TestCard key={test._id} test={test} />
                    ))}
                  </div>
                )}
              </div>
            )}

            {activeView === "categoryList" && (
              <div>
                {categoryList.length === 0 ? (
                  <div className="text-center py-8 md:py-12">
                    <div className="w-14 h-14 md:w-16 md:h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                      <Icons.EmptyState className="w-6 h-6 md:w-8 md:h-8 text-gray-400" />
                    </div>
                    <h3 className="text-base md:text-lg font-semibold text-gray-700 mb-2">No categories found</h3>
                    <p className="text-sm text-gray-500 mb-4">Add your first category to get started</p>
                    <button
                      onClick={() => setModal({ view: "addCategory" })}
                      className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm md:text-base"
                    >
                      Add New Category
                    </button>
                  </div>
                ) : (
                  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    {categoryList.map((category) => (
                      <CategoryCard key={category._id} category={category} />
                    ))}
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>

      {/* Modals */}
      <Modal isOpen={modal.view === "addTest" || modal.view === "editTest"}>
        <TestForm />
      </Modal>

      <Modal isOpen={modal.view === "addCategory" || modal.view === "editCategory"}>
        <CategoryForm />
      </Modal>
    </div>
  );
};

export default TestList;

The above component is the parent component and the followings are the children:

import useStore from "./store";
import Icons from "../../components/icons";

const CategoryCard = ({ category }) => {
  const { setPopup, setModal } = useStore();

  const handleDelete = () => {
    setPopup({
      type: "confirmation",
      message: `Delete ${category.name}?`,
      action: "deleteCategory",
      data: { categoryId: category._id },
    });
  };

  const handleEdit = () => {
    setModal({
      view: "editCategory",
      data: { categoryId: category._id, name: category.name },
    });
  };

  return (
    <div className="group bg-white rounded-xl border border-gray-200 hover:border-gray-300 transition-all duration-200 shadow-sm hover:shadow-md p-4">
      <div className="flex items-center justify-between">
        {/* Category Name */}
        <div className="flex items-center space-x-3">
          <div className="w-10 h-10 flex items-center justify-center rounded-lg bg-blue-50 text-blue-600">
            <Icons.Details className="w-5 h-5" />
          </div>
          <div>
            <h3 className="font-medium text-gray-900">{category.name}</h3>
          </div>
        </div>

        {/* Action Buttons - Fixed for mobile */}
        <div className="flex items-center space-x-1 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity duration-200">
          <button
            onClick={handleEdit}
            className="p-2 rounded-lg hover:bg-gray-100 text-gray-600 hover:text-blue-600 transition-colors duration-150"
            aria-label="Edit category"
          >
            <Icons.Edit className="w-5 h-5" />
          </button>
          <button
            onClick={handleDelete}
            className="p-2 rounded-lg hover:bg-gray-100 text-gray-600 hover:text-red-600 transition-colors duration-150"
            aria-label="Delete category"
          >
            <Icons.Delete className="w-5 h-5" />
          </button>
        </div>
      </div>
    </div>
  );
};

export default CategoryCard;


import React, { useState, useMemo, useEffect } from "react";
import TestCard from "./TestCard";
import Icons from "../../components/icons";

const getCategoryTheme = (categoryName) => {
  const colorSchemes = [
    { bg: "bg-blue-50", text: "text-blue-600", border: "border-blue-200" },
    { bg: "bg-red-50", text: "text-red-600", border: "border-red-200" },
    { bg: "bg-green-50", text: "text-green-600", border: "border-green-200" },
    { bg: "bg-purple-50", text: "text-purple-600", border: "border-purple-200" },
    { bg: "bg-yellow-50", text: "text-yellow-600", border: "border-yellow-200" },
    { bg: "bg-pink-50", text: "text-pink-600", border: "border-pink-200" },
  ];
  const schemeIndex =
    Math.abs(categoryName.split("").reduce((acc, char) => acc + char.charCodeAt(0), 0)) % colorSchemes.length;
  return colorSchemes[schemeIndex];
};

const Container = ({ list }) => {
  const [expandedCategories, setExpandedCategories] = useState({});
  const [searchTerm, setSearchTerm] = useState("");
  const [activeCategory, setActiveCategory] = useState("ALL");
  const [sortConfig, setSortConfig] = useState({ key: "name", direction: "asc" });

  useEffect(() => {
    if (searchTerm.trim() || activeCategory !== "ALL") {
      const newExpanded = {};
      filteredList.forEach((category) => {
        if (category.testList.length > 0) newExpanded[category._id] = true;
      });
      setExpandedCategories(newExpanded);
    } else {
      setExpandedCategories({});
    }
  }, [searchTerm, activeCategory]);

  const filteredList = useMemo(() => {
    let result = [...list];

    if (searchTerm.trim()) {
      result = result
        .map((category) => {
          const filteredTests = category.testList.filter(
            (test) =>
              test.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
              category.categoryName.toLowerCase().includes(searchTerm.toLowerCase()) ||
              test._id.toLowerCase().includes(searchTerm.toLowerCase())
          );
          return filteredTests.length > 0 ? { ...category, testList: filteredTests } : null;
        })
        .filter(Boolean);
    }

    if (activeCategory !== "ALL") {
      result = result.filter((category) => category.categoryName === activeCategory);
    }

    if (sortConfig.key === "name") {
      result.sort((a, b) =>
        sortConfig.direction === "asc"
          ? a.categoryName.localeCompare(b.categoryName)
          : b.categoryName.localeCompare(a.categoryName)
      );
    } else if (sortConfig.key === "count") {
      result.sort((a, b) =>
        sortConfig.direction === "asc" ? a.testList.length - b.testList.length : b.testList.length - a.testList.length
      );
    }

    return result;
  }, [list, searchTerm, activeCategory, sortConfig]);

  const toggleCategory = (categoryId) => {
    setExpandedCategories((prev) => ({
      ...prev,
      [categoryId]: !prev[categoryId],
    }));
  };

  const expandAll = () => {
    const allExpanded = {};
    list.forEach((category) => {
      if (category.testList.length > 0) allExpanded[category._id] = true;
    });
    setExpandedCategories(allExpanded);
  };

  const collapseAll = () => {
    setExpandedCategories({});
  };

  const handleSort = (key) => {
    setSortConfig((prev) => ({
      key,
      direction: prev.key === key && prev.direction === "asc" ? "desc" : "asc",
    }));
  };

  const clearAllFilters = () => {
    setSearchTerm("");
    setActiveCategory("ALL");
    setExpandedCategories({});
  };

  return (
    <div className="p-4 sm:p-6">
      {/* Compact Header */}
      <div className="mb-6">
        {/* Desktop: Single row layout */}
        <div className="hidden sm:flex items-center gap-3 mb-4">
          <div className="flex items-center gap-2">
            <button
              onClick={expandAll}
              className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition-colors flex items-center gap-1.5"
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
              </svg>
              Expand
            </button>
            <button
              onClick={collapseAll}
              className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition-colors flex items-center gap-1.5"
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 12H4" />
              </svg>
              Collapse
            </button>
          </div>

          <div className="flex-1 max-w-md">
            <div className="relative">
              <input
                type="text"
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                placeholder="Search tests or categories..."
                className="w-full px-3 py-2 pl-9 bg-gray-50 border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm"
              />
              <div className="absolute left-2.5 top-2.5 text-gray-400">
                <Icons.Search className="w-4 h-4" />
              </div>
            </div>
          </div>

          <button
            onClick={() => handleSort("name")}
            className="px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition-colors flex items-center gap-1.5"
          >
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"
              />
            </svg>
            Sort {sortConfig.key === "name" && (sortConfig.direction === "asc" ? "A-Z" : "Z-A")}
          </button>
        </div>

        {/* Mobile: Two rows layout */}
        <div className="sm:hidden space-y-3 mb-4">
          {/* Row 1: Expand/Collapse and Sort */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <button
                onClick={expandAll}
                className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition-colors flex items-center gap-1.5"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                </svg>
                Expand
              </button>
              <button
                onClick={collapseAll}
                className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition-colors flex items-center gap-1.5"
              >
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 12H4" />
                </svg>
                Collapse
              </button>
            </div>
            <button
              onClick={() => handleSort("name")}
              className="px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm transition-colors flex items-center gap-1.5"
            >
              <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"
                />
              </svg>
              Sort
            </button>
          </div>

          {/* Row 2: Search */}
          <div className="relative">
            <input
              type="text"
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              placeholder="Search tests or categories..."
              className="w-full px-3 py-2 pl-9 bg-gray-50 border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm"
            />
            <div className="absolute left-2.5 top-2.5 text-gray-400">
              <Icons.Search className="w-4 h-4" />
            </div>
          </div>
        </div>

        {/* Filter chips and clear button */}
        {(searchTerm || activeCategory !== "ALL") && (
          <div className="mt-3 flex items-center justify-between">
            <div className="flex flex-wrap gap-1">
              {searchTerm && (
                <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs flex items-center gap-1">
                  <Icons.Search className="w-3 h-3" />
                  {searchTerm}
                </span>
              )}
              {activeCategory !== "ALL" && (
                <span className="px-2 py-1 bg-green-100 text-green-700 rounded text-xs flex items-center gap-1">
                  <Icons.Folder className="w-3 h-3" />
                  {activeCategory}
                </span>
              )}
            </div>
            <button
              onClick={clearAllFilters}
              className="text-xs text-red-600 hover:text-red-800 font-medium flex items-center gap-1"
            >
              <Icons.Close className="w-3 h-3" />
              Clear
            </button>
          </div>
        )}

        {/* Summary text */}
        <div className="text-sm text-gray-500 mb-4">
          Showing {filteredList.reduce((acc, cat) => acc + cat.testList.length, 0)} tests
          {filteredList.length > 0 && ` in ${filteredList.length} categories`}
        </div>
      </div>

      {filteredList.length === 0 ? (
        <div className="text-center py-8 bg-white rounded-lg border border-gray-200">
          <div className="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <Icons.EmptyState className="w-6 h-6 text-gray-400" />
          </div>
          <h3 className="text-base font-semibold text-gray-700 mb-2">No tests found</h3>
          {(searchTerm || activeCategory !== "ALL") && (
            <button
              onClick={clearAllFilters}
              className="mt-3 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors text-sm flex items-center gap-2 mx-auto"
            >
              <Icons.Close className="w-4 h-4" />
              Clear Filters
            </button>
          )}
        </div>
      ) : (
        <div className="space-y-4">
          {filteredList.map((category) => {
            const isExpanded = expandedCategories[category._id] || false;
            const theme = getCategoryTheme(category.categoryName);
            const liveTests = category.testList.filter((test) => test.schemaId).length;

            return (
              <div key={category._id} className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                <div
                  className="p-4 cursor-pointer hover:bg-gray-50 transition-colors"
                  onClick={() => toggleCategory(category._id)}
                >
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3 flex-1">
                      <div
                        className={`w-10 h-10 rounded-lg flex items-center justify-center ${theme.bg} border ${theme.border}`}
                      >
                        <span className="text-lg">
                          {category.categoryName === "BLOOD" ? "ðŸ©¸" : category.categoryName === "URINE" ? "ðŸ§ª" : "ðŸ“‹"}
                        </span>
                      </div>
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2 mb-1">
                          <h2 className="text-lg font-semibold text-gray-900 truncate">{category.categoryName}</h2>
                          <span className="px-1.5 py-0.5 bg-gray-100 text-gray-600 text-xs font-medium rounded">
                            {category.testList.length} tests
                          </span>
                        </div>
                        <div className="flex items-center gap-3 text-xs">
                          {liveTests > 0 && (
                            <span className="flex items-center gap-1 text-green-600">
                              <div className="w-1.5 h-1.5 bg-green-500 rounded-full"></div>
                              {liveTests} live
                            </span>
                          )}
                          {category.testList.length - liveTests > 0 && (
                            <span className="flex items-center gap-1 text-yellow-600">
                              <div className="w-1.5 h-1.5 bg-yellow-500 rounded-full"></div>
                              {category.testList.length - liveTests} offline
                            </span>
                          )}
                        </div>
                      </div>
                    </div>
                    <Icons.ChevronDown
                      className={`w-5 h-5 text-gray-400 transform transition-transform ${
                        isExpanded ? "rotate-180" : ""
                      }`}
                    />
                  </div>
                </div>

                <div
                  className={`transition-all duration-300 border-t border-gray-100 ${
                    isExpanded ? "max-h-[5000px]" : "max-h-0"
                  } overflow-hidden`}
                >
                  {category.testList.length > 0 ? (
                    <div className="p-4">
                      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
                        {category.testList.map((test) => (
                          <TestCard
                            key={test._id}
                            test={{ ...test, categoryId: category._id, schemaId: test.schemaId || null }}
                          />
                        ))}
                      </div>
                    </div>
                  ) : (
                    <div className="p-4 text-center text-gray-500">No tests in this category</div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      )}

      <div className="mt-6 bg-gray-50 rounded-lg p-4 border border-gray-200">
        <div className="text-center text-xs text-gray-500">
          Total: {list.reduce((acc, cat) => acc + cat.testList.length, 0)} tests â€¢
          {list.reduce((acc, cat) => acc + cat.testList.filter((t) => t.schemaId).length, 0)} live â€¢
          {list.reduce((acc, cat) => acc + cat.testList.filter((t) => !t.schemaId).length, 0)} offline
        </div>
      </div>
    </div>
  );
};

export default Container;

import { useEffect, useState } from "react";
import InputField from "../../components/html/InputField";
import useStore from "./store";
import Icons from "../../components/icons";

const CategoryForm = () => {
  const { addCategory, editCategory, modal, closeModal } = useStore();
  const [name, setName] = useState(modal?.data?.name || "");

  const handleSubmit = () => {
    if (modal.view === "addCategory") {
      addCategory(name);
    } else if (modal.view === "editCategory") {
      editCategory(modal.data.categoryId, name);
    }
  };

  return (
    <div className="p-6 max-w-md w-full">
      <div className="flex items-center gap-3 mb-6">
        <div className="bg-blue-100 p-2 rounded-lg">
          <Icons.Details className="w-5 h-5 text-blue-600" />
        </div>
        <div>
          <h2 className="text-xl font-bold text-gray-900">
            {modal.view === "addCategory" ? "Create New Category" : "Edit Category"}
          </h2>
        </div>
      </div>

      <div className="space-y-4">
        {modal.view === "addCategory" && (
          <div className="flex flex-col space-y-2">
            <InputField
              value={name}
              onChange={(e) => setName(e.target.value.toUpperCase())}
              label="Category Name"
              type="text"
            />
          </div>
        )}

        {modal.view === "editCategory" && (
          <div className="flex flex-col space-y-2">
            <InputField
              value={name}
              onChange={(e) => setName(e.target.value.toUpperCase())}
              label="Category Name"
              type="text"
            />
          </div>
        )}

        <div className="flex gap-3 pt-4">
          <button
            onClick={handleSubmit}
            className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-3 rounded-lg font-semibold transition-colors flex items-center gap-2 justify-center"
          >
            <Icons.Add className="w-4 h-4" />
            {modal.view === "addCategory" ? "Create Category" : "Update Category"}
          </button>

          <button
            onClick={closeModal}
            className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold transition-colors"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  );
};

export default CategoryForm;

import { useEffect, useState } from "react";
import InputField from "../../components/html/InputField";
import SelectField from "../../components/html/SelectField";
import useStore from "./store";
import Icons from "../../components/icons";

const TestForm = () => {
  const { addTest, editTest, categoryList, loadCategoryList, modal, closeModal } = useStore();
  const [name, setName] = useState(modal?.data?.name || "");
  const [selectedCategoryId, setSelectedCategoryId] = useState(modal?.data?.categoryId || "");

  useEffect(() => {
    loadCategoryList();
  }, []);


  
  const categoryOptions = categoryList.map((category) => ({
    value: category._id,
    label: category.name,
  }));

  const handleSubmit = () => {
    if (modal.view === "addTest") {
      addTest(selectedCategoryId, name);
    } else if (modal.view === "editTest") {
      console.log("Test Id- " + modal.data.testId);
      console.log("Category Id- " + selectedCategoryId);
      console.log("Name- " + modal.data.name);
      editTest(modal.data.testId, selectedCategoryId, name);
    }
  };

  return (
    <div className="p-6 max-w-md w-full">
      <div className="flex items-center gap-3 mb-6">
        <div className="bg-blue-100 p-2 rounded-lg">
          <Icons.Details className="w-5 h-5 text-blue-600" />
        </div>
        <div>
          <h2 className="text-xl font-bold text-gray-900">
            {modal.view === "addTest" ? "Create New Test" : "Edit Test"}
          </h2>
        </div>
      </div>

      <div className="space-y-4">
        {modal.view === "addTest" && (
          <div className="flex flex-col space-y-2">
            <InputField
              value={name}
              onChange={(e) => setName(e.target.value.toUpperCase())}
              label="Test Name"
              type="text"
              placeholder="Enter test name"
            />
            <SelectField
              label="Category"
              name="category"
              value={selectedCategoryId}
              onChange={(e) => setSelectedCategoryId(e.target.value)}
              options={categoryOptions}
              placeholder="Select category"
            />
          </div>
        )}

        {modal.view === "editTest" && (
          <div className="flex flex-col space-y-2">
            <InputField
              value={name}
              onChange={(e) => setName(e.target.value.toUpperCase())}
              label="Test Name"
              type="text"
              placeholder="Enter test name"
            />
            <SelectField
              label="Category"
              name="category"
              value={selectedCategoryId}
              onChange={(e) => setSelectedCategoryId(e.target.value)}
              options={categoryOptions}
              placeholder="Select category"
            />
          </div>
        )}

        <div className="flex gap-3 pt-4">
          <button
            onClick={handleSubmit}
            className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white py-3 rounded-lg font-semibold transition-colors flex items-center gap-2 justify-center"
          >
            <Icons.Add className="w-4 h-4" />
            {modal.view === "addTest" ? "Create Test" : "Update Test"}
          </button>

          <button
            onClick={closeModal}
            className="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold transition-colors"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>
  );
};

export default TestForm;

import { Link } from "react-router-dom";
import useStore from "./store";
import Icons from "../../components/icons";

const TestCard = ({ test }) => {
  const { setPopup, setModal } = useStore();

  if (!test) {
    return (
      <div className="text-center py-6 border-2 border-dashed border-gray-200 rounded-lg">
        <Icons.Details className="w-8 h-8 text-gray-300 mx-auto mb-2" />
        <p className="text-gray-500 text-sm">No test data available</p>
      </div>
    );
  }

  return (
    <div className="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-sm transition-all group">
      {/* Header with status and test name */}
      <div className="flex items-center justify-between mb-4">
        <div className="flex items-center gap-3 min-w-0 flex-1">
          <div className={`p-2 rounded-lg ${test.schemaId ? "bg-green-100" : "bg-yellow-100"}`}>
            {test.schemaId ? (
              <Icons.PowerOn className="w-5 h-5 text-green-600" />
            ) : (
              <Icons.PowerOff className="w-5 h-5 text-yellow-600" />
            )}
          </div>
          <h4 className="font-medium text-gray-900 text-base truncate">{test.name}</h4>
        </div>

        {/* Status badge - moved to top right */}
        {test.schemaId ? (
          <span className="flex items-center gap-1 bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-medium shrink-0 ml-2">
            <div className="w-2 h-2 bg-green-500 rounded-full"></div>
            Live
          </span>
        ) : (
          <span className="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-sm font-medium shrink-0 ml-2">
            Offline
          </span>
        )}
      </div>

      {/* Icon Actions */}
      <div className="flex justify-between gap-2">
        {test.schemaId ? (
          <>
            <Link
              to={"/render-schema/" + test.schemaId}
              className="p-3 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center justify-center flex-1"
              title="View Form"
            >
              <Icons.View className="w-5 h-5" />
            </Link>
            <button
              onClick={() =>
                setModal({
                  view: "setSchema",
                  data: { categoryId: test.categoryId, testId: test._id, selectedSchema: test.schemaId },
                })
              }
              className="p-3 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors flex items-center justify-center flex-1"
              title="Change Schema"
            >
              <Icons.Settings className="w-5 h-5" />
            </button>
            <button
              onClick={() => {
                setPopup({
                  type: "confirmation",
                  message: `Unset schema for ${test.name}?`,
                  action: "unsetSchema",
                  data: { name: test.name, testId: test._id, categoryId: test.categoryId },
                });
              }}
              className="p-3 text-yellow-600 hover:bg-yellow-50 rounded-lg transition-colors flex items-center justify-center flex-1"
              title="Unset Schema"
            >
              <Icons.Unlink className="w-5 h-5" />
            </button>
          </>
        ) : (
          <button
            onClick={() => setModal({ view: "setSchema", data: { categoryId: test.categoryId, testId: test._id } })}
            className="p-3 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors flex items-center justify-center flex-1"
            title="Set Schema"
          >
            <Icons.PowerOn className="w-5 h-5" />
          </button>
        )}

        <button
          onClick={() => {
            setModal({
              view: "editTest",
              data: { categoryId: test.categoryId, testId: test._id, name: test.name },
            });
          }}
          className="p-3 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors flex items-center justify-center flex-1"
          title="Edit Test"
        >
          <Icons.Edit className="w-5 h-5" />
        </button>

        <button
          onClick={() => {
            setPopup({
              type: "confirmation",
              message: `Delete ${test.name}?`,
              action: "deleteTest",
              data: { testId: test._id },
            });
          }}
          className="p-3 text-red-600 hover:bg-red-50 rounded-lg transition-colors flex items-center justify-center flex-1"
          title="Delete Test"
        >
          <Icons.Delete className="w-5 h-5" />
        </button>
      </div>
    </div>
  );
};

export default TestCard;




